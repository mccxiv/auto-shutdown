<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout.html">
        <link rel="import" href="bower_components/neon-animation/neon-animated-pages.html">
        <link rel="import" href="bower_components/neon-animation/neon-animatable.html">
        <link rel="import" href="bower_components/neon-animation/neon-animations.html">
        <link rel="import" href="bower_components/paper-styles/paper-styles.html">

        <link rel="import" href="components/main-grid.html">
        <link rel="import" href="components/timer-selection.html">
        <link rel="import" href="components/countdown-timer.html">

        <title></title>
        <style is="custom-style">
            * {box-sizing: border-box;}

            body {
                margin: 0;
                background-color: white;
                color: #3d3d3d;
                @apply(--paper-font-body1);
            }

            #pages > neon-animatable > * {
                height: 100%;
                width: 100%;
            }

            .fullbleed {
                height: 100vh;
                margin: 0;
                overflow: hidden;
            }
        </style>
    </head>
    <body>
        <template is="dom-bind" id="app">
            <neon-animated-pages id="pages" class="fullbleed layout vertical pages" selected="[[selected]]" entry-animation="scale-up-animation" exit-animation="scale-down-animation">
                <neon-animatable>
                    <main-grid primary-color="{{primaryColor}}" operation="{{operation}}"></main-grid>
                </neon-animatable>
                <neon-animatable>
                    <timer-selection primary-color="[[primaryColor]]" operation="[[operation]]"></timer-selection>
                </neon-animatable>
                <neon-animatable>
                    <countdown-timer primary-color="[[primaryColor]]" operation="[[operation]]" seconds-left="[[secondsLeft]]"></countdown-timer>
                </neon-animatable>
                <neon-animatable class="info-page">
                    INFO SCREEN
                </neon-animatable>
            </neon-animated-pages>
        </template>

        <script>
            var ipc = require('ipc');
            var app = document.getElementById('app');

            app.addEventListener('dom-change', function(e) {
                e.target.removeEventListener(e.type, arguments.callee);
                var grid = app.$.pages.querySelector('main-grid');
                var timerSelection = app.$.pages.querySelector('timer-selection');
                var countdownTimer = app.$.pages.querySelector('countdown-timer');

                app.selected = 0;

                grid.addEventListener('operation', function() {
                    var timerPages = ['shutdown', 'restart', 'hibernate'];
                    if (timerPages.indexOf(app.operation) > -1) app.selected = 1;
                });

                timerSelection.addEventListener('timer', function(e) {
                    startOperation(app.operation, e.detail);
                    app.selected = 2;
                });

                timerSelection.addEventListener('back', function() {
                   app.selected = 0;
                });

                countdownTimer.addEventListener('cancel', function() {
                    ipc.send('cancel');
                    app.selected = 1;
                })
            });

            function startOperation(operation, seconds) {
                ipc.send(operation, seconds);
                requestSecondsLeft();
            }

            ipc.on('seconds-left', function(seconds) {
                app.secondsLeft = seconds;
                if (seconds) setTimeout(requestSecondsLeft, 500);
            });

            function requestSecondsLeft() {
                ipc.send('seconds-left?');
            }

        </script>
    </body>
</html>