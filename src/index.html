<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout.html">
        <link rel="import" href="bower_components/neon-animation/neon-animated-pages.html">
        <link rel="import" href="bower_components/neon-animation/neon-animatable.html">
        <link rel="import" href="bower_components/neon-animation/neon-animations.html">
        <link rel="import" href="bower_components/paper-button/paper-button.html">
        <link rel="import" href="bower_components/iron-icons/iron-icons.html">
        <link rel="import" href="bower_components/iron-icons/av-icons.html">
        <link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
        <link rel="import" href="bower_components/paper-styles/paper-styles.html">
        <link rel="import" href="bower_components/paper-styles/paper-styles-classes.html">
        <link rel="import" href="bower_components/paper-styles/color.html">

        <link rel="import" href="components/main-grid.html">
        <link rel="import" href="components/timer-selection.html">

        <title></title>
        <style is="custom-style">
            * {box-sizing: border-box;}

            body {
                margin: 0;
                background-color: black;
                color: #3d3d3d;
                @apply(--paper-font-body1);
            }

            #pages > neon-animatable > * {
                height: 100%;
                width: 100%;
            }

            .back-button {
                position: absolute;
                top: 15px;
                left: 15px;
            }

            .fullbleed {
                height: 100vh;
                margin: 0;
                overflow: hidden;
            }

            paper-button {
                background: var(--paper-grey-300);
            }
        </style>
    </head>
    <body>
        <template is="dom-bind" id="app">
            <neon-animated-pages id="pages" class="fullbleed layout vertical pages" selected="[[selected]]" entry-animation="scale-up-animation" exit-animation="scale-down-animation">
                <neon-animatable>
                    <main-grid primary-color="{{primaryColor}}" secondary-color="{{secondaryColor}}" operation="{{operation}}"></main-grid>
                </neon-animatable>
                <neon-animatable>
                    <timer-selection operation="[[operation]]"></timer-selection>
                </neon-animatable>
                <neon-animatable data-static-classes="timer-page layout vertical center-center">

                </neon-animatable>
                <neon-animatable class="info-page">
                    INFO SCREEN
                </neon-animatable>
            </neon-animated-pages>
        </template>

        <script>
            var ipc = require('ipc');
            var app = document.getElementById('app');

            app.addEventListener('dom-change', function(e) {
                e.target.removeEventListener(e.type, arguments.callee);
                var grid = app.$.pages.querySelector('main-grid');
                var timerSelection = app.$.pages.querySelector('timer-selection');

                app.selected = 0;

                grid.addEventListener('operation', function() {
                    var timerPages = ['shutdown', 'restart', 'hibernate'];
                    if (timerPages.indexOf(app.operation) > -1) app.selected = 1;
                });

                timerSelection.addEventListener('timer', function(seconds) {
                    ipc.send(app.operation, {seconds: seconds});
                    app.selected = 2;
                });

                timerSelection.addEventListener('back', function() {
                   app.selected = 0;
                });
            });


            var scope = {};

            scope.operation = '';
            scope.colorClass = '';

            scope.pagePickTimer = function(e) {
                if (e.currentTarget.dataset.colorClass) scope.colorClass = e.currentTarget.dataset.colorClass;
                if (e.currentTarget.dataset.operation) scope.operation = e.currentTarget.dataset.operation;
                scope.selected = 1;
            };

            scope.pagePickOperation = function() {
                scope.selected = 0;
            };

            scope.info = function() {
                scope.selected = 3;
            };

            scope.capitalize = function(string) {
                return string.charAt(0).toUpperCase() + string.slice(1);
            };

            scope.pageStartTimer = function(e) {
                var seconds = e.currentTarget.dataset.seconds;
                if (seconds) ipc.send(scope.operation, seconds);
                scope.selected = 2;
            };

            scope.calcPagePickTimerClasses = function(colorClass) {
                return scope.$.pagePickTimer.dataset.staticClasses + ' ' + colorClass;
            };

            scope.calcPageStartTimerClasses = function(colorClass) {
                return scope.$.pageStartTimer.dataset.staticClasses + ' ' + colorClass;
            };

        </script>
    </body>
</html>